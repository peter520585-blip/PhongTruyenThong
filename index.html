<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Hệ Thống WebAR - Scalable</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    /* ... Copy lại CSS cũ của bạn vào đây ... */
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
    #info-panel { position: fixed; bottom: 20px; left: 20px; right: 20px; z-index: 100; background: rgba(10, 10, 10, 0.75); backdrop-filter: blur(8px); border-left: 3px solid #fff; padding: 10px 15px; border-radius: 6px; color: #fff; max-height: 25%; overflow-y: auto; word-wrap: break-word; opacity: 0; transform: translateY(20px); transition: opacity 0.5s ease, transform 0.5s ease; }
    #info-panel.visible { opacity: 1; transform: translateY(0); }
    #ui-title { margin: 0 0 4px 0; font-size: 16px; font-weight: 700; text-transform: uppercase; }
    #ui-desc { margin: 0; font-size: 13px; line-height: 1.4; color: #e0e0e0; text-align: left; }

    /* UI CHỤP ẢNH */
    #btn-capture { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 60px; height: 60px; background: rgba(255, 255, 255, 0.9); border: 4px solid #ccc; border-radius: 50%; z-index: 200; display: none; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    #btn-capture:active { transform: translateX(-50%) scale(0.95); background: #fff; }
    
    /* UI PREVIEW (Sau khi chụp) */
    #preview-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 300; background: #000; display: none; flex-direction: column; }
    #preview-image { width: 100%; height: 100%; object-fit: contain; }
    
    .preview-controls { position: absolute; bottom: 30px; left: 0; width: 100%; display: flex; justify-content: space-between; padding: 0 40px; box-sizing: border-box; }
    
    .btn-action { padding: 10px 20px; border-radius: 30px; font-weight: bold; font-size: 14px; cursor: pointer; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.5); text-transform: uppercase; }
    
    #btn-save { background: #4CAF50; color: white; } /* Nút Lưu bên trái */
    #btn-exit { background: #f44336; color: white; } /* Nút Thoát bên phải */

    /* Ẩn các UI khác khi đang xem preview */
    body.in-preview #info-panel, 
    body.in-preview #btn-capture { display: none !important; }
    body.in-preview .mindar-ui-scanning { display: none !important; }
  </style>

  <script src="./js/database.js"></script>   <script src="./js/components.js"></script> <script src="./js/main.js"></script>       </head>

<body>
  <div id="info-panel"><div id="ui-title"></div><div id="ui-desc"></div></div>

  <!-- Nút chụp ảnh (Hiện khi có target) -->
  <button id="btn-capture"></button>

  <!-- Màn hình xem trước ảnh -->
  <div id="preview-container">
    <img id="preview-image" src="" alt="Snapshot">
    <div class="preview-controls">
      <button id="btn-save" class="btn-action">Lưu ảnh</button>
      <button id="btn-exit" class="btn-action">Thoát</button>
    </div>
  </div>

  <a-scene
    mindar-image="imageTargetSrc: ./targets.mind; filterMinCF:0.0001; filterBeta:0.001; uiLoading: no; autoStart: true;"
    renderer="colorManagement: true, physicallyCorrectLights; preserveDrawingBuffer: true;"
    color-space="sRGB"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    embedded
  >
    <a-assets>
      </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    </a-scene>

  <script>
    // Code unlock audio nhỏ gọn để ở đây
    function unlockAudio() {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (AudioContext) { new AudioContext().resume(); }
      document.body.removeEventListener('click', unlockAudio);
      document.body.removeEventListener('touchstart', unlockAudio);
    }
    document.body.addEventListener('click', unlockAudio);
    document.body.addEventListener('touchstart', unlockAudio);
  </script>
</body>
</html>